<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- libraries CSS -->
    <link rel="stylesheet" href="/static/icon/flaticon_glamer.css">
    <link rel="stylesheet" href="/static/vendor/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="/static/vendor/splide/splide.min.css">
    <link rel="stylesheet" href="/static/vendor/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" href="/static/vendor/slim-select/slimselect.css">
    <link rel="stylesheet" href="/static/vendor/animate-wow/animate.min.css">
    <link rel="stylesheet" href="/static/vendor/no-ui-slider/nouislider.min.css">

    <!-- custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- page-specific image ratio fix for product grid -->
    <style>
      .ul-product .ul-product-img {
        aspect-ratio: 1 / 1; /* change to 4 / 3 or 16 / 9 if preferred */
        width: 100%;
        overflow: hidden;
        background: #fff;
        display: block;
      }
      .ul-product .ul-product-img img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* keep natural aspect without cropping */
        display: block;
      }

      /* Strong mobile override for shop grid */
      @media (max-width: 991px) {
        .ul-shop-products-grid {
          display: grid !important;
          grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
          gap: 12px !important;
        }

        .ul-shop-products-grid > .col {
          width: auto !important;
          max-width: none !important;
          flex: unset !important;
          padding: 0 !important;
        }

        .ul-product {
          height: 100% !important;
          padding: 12px !important;
          border-radius: 12px !important;
        }

        .ul-product-title a {
          font-size: 15px !important;
          line-height: 1.35 !important;
        }
      }

      @media (max-width: 575px) {
        .ul-shop-products-grid {
          grid-template-columns: 1fr !important;
        }
      }
    </style>
</head>

<body>
    {% include 'header.html' %}
    <main>
        <!-- BREADCRUMB SECTION START -->
        <div class="ul-container">
            <div class="ul-breadcrumb">
                <h2 class="ul-breadcrumb-title">Discover Our Products</h2>
                <div class="ul-breadcrumb-nav">
                    <a href="/"><i class="flaticon-home"></i> Home</a>
                    <i class="flaticon-arrow-point-to-right"></i>
                    <span class="current-page">Shop</span>
                </div>
            </div>
        </div>

        <div class="ul-inner-page-container">
            <div class="ul-inner-products-wrapper">
                <div class="row ul-bs-row flex-column-reverse flex-md-row">
                    <!-- right products container -->
                    <div class="col-12">
                        <div class="row ul-bs-row row-cols-lg-4 row-cols-sm-3 row-cols-2 row-cols-xxs-1 ul-shop-products-grid">
                            {% for product in products %}
                            <!-- product card -->
                            <div class="col">
                                <div class="ul-product" style="height: 100%;">
                                    <a href="/shop-details?id={{ product.id }}">
                                    <div class="ul-product-heading">
                                        <span class="ul-product-price text-danger">{{ product.price }}</span>
                                        {% if product.discount %}
                                        <span class="ul-product-discount-tag">{{ product.discount }}</span>
                                        {% endif %}
                                    </div>

                                    <div class="ul-product-img" data-product-id="{{ product.id }}">
                                        <img class="product-main-img" src="/static/{{ product.image_path }}" alt="{{ product.image_alt }}" loading="lazy" decoding="async" onerror="this.onerror=null; this.src='/static/images/logo.png'">

                                        {% if product.images %}
                                        <div class="product-color-controls" style="margin-top:8px;">
                                            <div style="font-size:12px; color:#666; margin-bottom:6px;">
                                                Available in {{ product.images|length }} color{% if product.images|length > 1 %}s{% endif %}: 
                                                <span style="font-weight:500;">
                                                    {% for img in product.images %}
                                                        {{ img.color|title }}{% if not loop.last %},&nbsp;{% endif %}
                                                    {% endfor %}
                                                </span>
                                            </div>
                                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                                                <button type="button" class="show-colors-btn btn btn-primary btn-sm" data-product-id="{{ product.id }}" style="font-size:12px;">View Colors</button>
                                                <span class="selected-color-name" id="selected-color-{{ product.id }}" style="font-weight:600; font-size:13px;"></span>
                                            </div>

                                            <form class="color-variants" id="color-variants-{{ product.id }}" style="display:none; gap:6px; margin-top:8px; flex-wrap:wrap;">
                                                {% for img in product.images %}
                                                <label style="display:inline-flex; align-items:center; gap:4px; cursor:pointer;" title="{{ img.color }}">
                                                    <input type="radio" name="product-color-{{ product.id }}" hidden data-image="/static/{{ img.image_path }}" data-color="{{ img.color }}">
                                                    <span style="width:20px;height:20px;border-radius:50%;border:1px solid #ccc; background-color:{{ img.color }};"></span>
                                                    <span style="font-size:11px; white-space:nowrap;">{{ img.color|title }}</span>
                                                </label>
                                                {% endfor %}
                                            </form>
                                        </div>
                                        {% endif %}
                                    </div>

                                    <div class="ul-product-txt">
                                        <h4 class="ul-product-title"><a href="/shop-details?id={{ product.id }}">{{ product.name }}</a></h4>
                                        <h5 class="ul-product-category"><a href="/shop?category={{ product.category }}">{{ product.category }}</a></h5>
                                    </div>
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- pagination -->
                        <div class="ul-pagination">
                            {% if total_pages > 1 %}
                            <ul>
                                {% if current_page > 1 %}
                                <li><a href="{{ url_for('shop', page=current_page-1) }}"><i class="flaticon-left-arrow"></i></a></li>
                                {% endif %}
                                
                                <li class="pages">
                                    {% for page_num in range(1, total_pages + 1) %}
                                    <a href="{{ url_for('shop', page=page_num) }}" {% if page_num == current_page %}class="active"{% endif %}>
                                        {% if page_num < 10 %}0{% endif %}{{ page_num }}
                                    </a>
                                    {% endfor %}
                                </li>
                                
                                {% if current_page < total_pages %}
                                <li><a href="{{ url_for('shop', page=current_page+1) }}"><i class="flaticon-arrow-point-to-right"></i></a></li>
                                {% endif %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER SECTION START -->
    {% include 'footer.html' %}
    <!-- FOOTER SECTION END -->

    <!-- libraries JS -->
    <script src="/static/vendor/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="/static/vendor/splide/splide.min.js"></script>
    <script src="/static/vendor/splide/splide-extension-auto-scroll.min.js"></script>
    <script src="/static/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="/static/vendor/slim-select/slimselect.min.js"></script>
    <script src="/static/vendor/animate-wow/wow.min.js"></script>
    <script src="/static/vendor/splittype/index.min.js"></script>
    <script src="/static/vendor/mixitup/mixitup.min.js"></script>
    <script src="/static/vendor/fslightbox/fslightbox.js"></script>
    <script src="/static/vendor/no-ui-slider/nouislider.min.js"></script>

    <!-- custom JS -->
    <script src="/static/js/main.js"></script>
    <script>
    function capitalizeWords(str) {
        if (!str) return '';
        return str.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
    }

    // Product listing color toggle and swap
    document.addEventListener('DOMContentLoaded', function() {
        // toggle variants visibility
        document.querySelectorAll('.show-colors-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const id = btn.getAttribute('data-product-id');
                const form = document.getElementById('color-variants-' + id);
                if (!form) return;
                const isHidden = form.style.display === 'none' || form.style.display === '';
                form.style.display = isHidden ? 'flex' : 'none';
                btn.textContent = isHidden ? 'Hide Colors' : 'View Colors';
            });
        });

        // swatch click -> swap main image and show color name
        document.querySelectorAll('.color-variants').forEach(form => {
            form.addEventListener('change', function(e) {
                const input = e.target.closest('label')?.querySelector('input[type=radio]');
                if (!input) return;
                const imgSrc = input.dataset.image;
                const colorName = input.dataset.color;
                // find parent card main image
                const card = input.closest('.ul-product-img');
                if (card) {
                    const mainImg = card.querySelector('.product-main-img');
                    if (mainImg && imgSrc) mainImg.src = imgSrc;
                    const pid = card.getAttribute('data-product-id');
                    const nameEl = document.getElementById('selected-color-' + pid);
                    if (nameEl) nameEl.textContent = capitalizeWords(colorName);
                }
            });
        });

        // Initialize first color display
        document.querySelectorAll('.color-variants').forEach(form => {
            const firstInput = form.querySelector('input[type=radio]');
            if (firstInput && firstInput.dataset.color) {
                const pid = form.id.replace('color-variants-', '');
                const nameEl = document.getElementById('selected-color-' + pid);
                if (nameEl) nameEl.textContent = capitalizeWords(firstInput.dataset.color);
            }
        });
    });
    </script>
</body>

</html>
